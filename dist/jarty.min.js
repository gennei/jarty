!function(){var Jarty;!function(a){function b(a){return null===a||void 0===a?"":String(a)}function c(a,b,c){"undefined"==typeof c&&(c=10);for(var d=a.toString(c);d.length<b;)d="0"+d;return d.toUpperCase()}function d(a){var d=b(a).replace(/[\x00-\x1f\\]/g,function(a){return f[a]||"\\u00"+c(a.charCodeAt(0),2,16)});return'"'+d.replace(/"/g,'\\"')+'"'}function e(a){return a.replace(/(?:^|_)([a-z])/g,function(a,b){return b.toUpperCase()})}a.stringify=b,a.zeroPad=c;var f={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r","\\":"\\\\"};a.quote=d,a.camelize=e}(Jarty||(Jarty={}));var Jarty;!function(a){var b=function(){function b(a,b){this.message=a,this.position=b,this.name="Jarty.SyntaxError"}return b.prototype.toString=function(){var b=this.message;if(this.position){var c=this.position;b+="\n{line:"+c.row+", col:"+c.col+", source:"+a.quote(c.line)+"}"}return b},b}();a.SyntaxError=b;var c=function(){function a(a,b){this.message=a,this.runtime=b,this.name="Jarty.RuntimeError"}return a}();a.RuntimeError=c}(Jarty||(Jarty={}));var Jarty;!function(a){var b=function(a){for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b])},c=b.prototype;!function(a){function d(){for(var a=[],b=0;b<arguments.length-0;b++)a[b]=arguments[b+0];if(i=!0,1===a.length){var d=a[0];for(var e in d)d.hasOwnProperty(e)&&(c[e]=a[1])}else c[a[0]]=a[1]}function e(a){return c[a]}function f(a){delete c[a]}function g(){i=!1,c=b.prototype={}}function h(a){return i?new b(a):a}var i=!1;a.set=d,a.get=e,a.remove=f,a.clear=g,a.wrap=h}(a.Global||(a.Global={}));a.Global}(Jarty||(Jarty={}));var Jarty;!function(a){a.version="1.0.0-alpha"}(Jarty||(Jarty={}));var Jarty;!function(a){var b=function(){function b(a){this.runtime=a,this.foreachs={},this.captures={},this.counters={}}return b.prototype.getNow=function(){return(new Date).getTime()},b.prototype.getConst=function(){this.runtime.raiseError("not implemented: $jarty.const")},b.prototype.getVersion=function(){return a.version},b.prototype.getLdelim=function(){return"{"},b.prototype.getRdelim=function(){return"}"},b.prototype.getForeach=function(a,b){return a||this.runtime.raiseError("`$jarty.foreach` must be followed by foreach name"),b||this.runtime.raiseError("`$jarty.foreach."+a+"` must be followed by property name"),this.foreachs.hasOwnProperty(b)||this.runtime.raiseError("`$jarty.foreach."+a+"."+b+"` does not exist"),this.foreachs[a][b]},b.prototype.getCapture=function(a){return a||this.runtime.raiseError("`$jarty.capture` must be followed by capture name"),this.captures.hasOwnProperty(a)||this.runtime.raiseError("`$jarty.capture."+a+"` does not exist"),this.captures[a]},b}();a.Environment=b}(Jarty||(Jarty={}));var Jarty;!function(a){var b=function(){function b(a,b){this.runtime=a,this.value=b}return b.register=function(a,b){this.dict[a]=b},b.unregister=function(a){delete this.dict[a]},b.get=function(a){return this.dict[a]},b.prototype.call=function(a,c){var d=b.dict[a];return d&&(this.value=d.apply(this,[this.runtime,this.value].concat(c))),this},b.prototype.valueOf=function(){return this.value},b.prototype.toString=function(){return a.stringify(this.value)},b.dict={},b}();a.Pipes=b}(Jarty||(Jarty={}));var Jarty;!function(a){var b=function(){function a(){}return a.register=function(a,b){this.dict[a]=b},a.unregister=function(a){delete this.dict[a]},a.get=function(a){return this.dict[a]},a.dict={},a}();a.Functions=b}(Jarty||(Jarty={}));var Jarty;!function(a){var b=function(){function b(b){this.buffer="",this.dict=a.Global.wrap(b),this.env=new a.Environment(this)}return b.prototype.write=function(a){void 0!==a&&null!==a&&(this.buffer+=a)},b.prototype.finish=function(){return this.buffer},b.prototype.raiseError=function(b){throw new a.RuntimeError(b,this)},b.prototype.set=function(a,b){this.dict[a]=b},b.prototype.get=function(a,b){if(!(a in this.dict))return null;if(!b||0===b.length)return this.dict[a];for(var c,d,e=this.dict[a],f=null,g=0;null!==e&&void 0!==e&&g<b.length;)if(c=b[g++],c instanceof Array){if(!(e instanceof Function))return null;d=f,f=e,e=e.apply(d,c)}else{if(!(c in e))return null;f=e,e=e[c]}return e},b.prototype.getEnvVar=function(b){if(0===b.length)return null;var c=b[0],d=b.slice(1),e="get"+a.camelize(c);return"function"!=typeof this.env[e]&&this.raiseError("`$jarty."+c+"` does not exist"),this.env[e].apply(this.env,d)},b.prototype.pipe=function(b){return new a.Pipes(this,b)},b.prototype.call=function(b,c){var d=a.Functions.get(b);return d?d(this,c):null},b.prototype.foreach=function(a,b,c){var d=this;if(a.hasOwnProperty("from")||this.raiseError("foreach: `from` is not given"),a.hasOwnProperty("item")||this.raiseError("foreach: `item` is not given"),a.from){if(a.hasOwnProperty("name"))return this.namedForeach(a,b,c),void 0;var e=!1,f=a.key,g=a.item;this.iterate(a.from,function(a,c){f&&(d.dict[f]=a),d.dict[g]=c,b(),e=!0}),!e&&c&&c()}},b.prototype.namedForeach=function(a,b,c){var d,e=this,f=a.from;if("number"==typeof f.length)d=f.length;else{d=0;for(var g in f)f.hasOwnProperty(g)&&d++}var h=this.env.foreachs[a.name]={show:!1,total:d,first:!1,last:!1,index:0,iteration:1},i=!1,j=a.key,k=a.item;this.iterate(f,function(a,c,f){h.show=!0,h.first=0===f,h.last=f===d-1,h.index=f,h.iteration=f+1,j&&(e.dict[j]=a),e.dict[k]=c,b(),i=!0}),!i&&c&&c()},b.prototype.iterate=function(a,b){if(a)if("number"==typeof a.length)for(var c=0,d=a.length;d>c;c++)b(c,a[c],c);else{var e=0;for(var f in a)a.hasOwnProperty(f)&&b(f,a[f],e++)}},b.prototype.for_=function(a,b,c){a.hasOwnProperty("to")||this.raiseError("for: `to` is not given"),a.hasOwnProperty("item")||this.raiseError("for: `item` is not given");var d=parseInt(a.from)||0,e=parseInt(a.to)||0,f=parseInt(a.step)||1,g=!1,h=a.item;if(0>f)for(var i=d;i>=e;i+=f)this.dict[h]=i,b(),g=!0;else for(var i=d;e>=i;i+=f)this.dict[h]=i,b(),g=!0;!g&&c&&c()},b.prototype.startCapture=function(){},b.prototype.endCapture=function(){},b.prototype.startStrip=function(){},b.prototype.endStrip=function(){},b}();a.Runtime=b}(Jarty||(Jarty={}));var Jarty;!function(a){var b=function(){function a(a,b,c){this.context=a,this.rule=b,this.source=c,this.index=0,this.errorIndex=0,this.loopCount=0,this.remainSource=c}return a.prototype.enter=function(){this.rule.enter&&this.rule.enter(this.context)},a.prototype.leave=function(){this.rule.leave&&this.rule.leave(this.context)},a.prototype.found=function(a){var b=this.remainSource.slice(0,a.index);this.rule.found&&this.rule.found(this.context,a,b),this.errorIndex=this.index+a.index,this.index+=a.index+a[0].length,this.remainSource=this.remainSource.slice(a.index+a[0].length),this.loopCount++},a.prototype.notfound=function(){this.rule.notfound&&this.rule.notfound(this.context,this.remainSource),this.errorIndex=this.index,this.index+=this.remainSource.length,this.remainSource="",this.loopCount++},a.prototype.resume=function(){this.resumeCallback&&(this.resumeCallback(this.context),this.resumeCallback=void 0)},a.prototype.next=function(){if(!this.rule.pattern||0===this.remainSource.length)return!1;var a=this.rule.pattern.exec(this.remainSource);return a?(this.found(a),!0):(this.notfound(),!1)},a.prototype.toErrorPosition=function(){var a=this.source.lastIndexOf("\n",this.errorIndex)+1,b=this.source.indexOf("\n",this.errorIndex),c=this.source.substr(0,a).match(/\n/g);return{col:this.errorIndex-a+1,row:c?c.length+1:1,line:this.source.substring(a,-1===b?this.source.length:b),source:this.source}},a}(),c=function(){function a(){this.stack=[]}return a.prototype.pushScope=function(a){this.top=a,this.stack.push(a),this.top.enter()},a.prototype.popScope=function(){if(!this.top)throw new Error("Try to popScope on empty scope stack");this.top.leave(),this.stack.pop(),this.stack.length>0?(this.top=this.stack[this.stack.length-1],this.top.resume()):this.top=null},a.prototype.getErrorPosition=function(){return this.stack.length>0?this.stack[0].toErrorPosition():null},a}(),d=function(){function c(a,b){this.stack=a,this.source=b,this.buffer=""}return c.prototype.write=function(){for(var a=[],b=0;b<arguments.length-0;b++)a[b]=arguments[b+0];for(var c=0;c<a.length;c++)this.buffer+=a[c]},c.prototype.getTranslated=function(){return this.buffer},c.prototype.nest=function(a,c,d){void 0===c&&(c=this.stack.top.remainSource),this.stack.top.resumeCallback=d,this.stack.pushScope(new b(this,a,c))},c.prototype.getLoopCount=function(){return this.stack.top.loopCount},c.prototype.raiseError=function(b){throw new a.SyntaxError("Jarty parse error: "+b,this.stack.getErrorPosition())},c}(),e=function(){function a(a){this.rootRule=a}return a.prototype.translate=function(a){var e=new c,f=new d(e,a);for(e.pushScope(new b(f,this.rootRule,a));e.top;)e.top.next()===!1&&e.popScope();return f.getTranslated()},a}();a.Translator=e}(Jarty||(Jarty={}));var Jarty;!function(a){!function(b){var c='"[^"\\\\]*(?:\\\\.[^"\\\\]*)*"',d="'[^'\\\\]*(?:\\\\.[^'\\\\]*)*'",e="(?:"+c+"|"+d+")",f="(?:[+-]?\\d+(?:\\.\\d+)?)",g="[a-zA-Z_][a-zA-Z0-9_]*",h="(?:\\([^\\)]*\\))",i="(?:\\[(?:[^\\[\\]]+|\\[[^\\]]+\\])+\\])",j="(?:(?:\\.|->)"+g+"|(?:\\.|->)\\$"+g+i+"*|"+i+"|"+h+")",k="(?:\\$("+g+")("+j+"*))",l="(?:"+k+"|("+e+")|("+f+")|("+g+"))",m="(?:\\|@?"+g+"(?::"+l+")*)",n=l+"("+m+"*)",o="(?:\\(|\\)|&&|\\|\\||===?|>=|<=|!=|[!><%+/*-])",p="\\{\\*(.*?)\\*\\}",q="\\{\\s*literal\\s*\\}(.*?)\\{\\s*/literal\\s*\\}",r="\\{\\s*javascript\\s*\\}(.*?)\\{\\s*/javascript\\s*\\}",s="\\{\\s*((?:\\$"+g+"|"+e+"|"+f+").*?)\\s*\\}",t="\\{\\s*("+g+".*?)\\s*\\}",u="\\{\\s*/("+g+")\\s*\\}";b.start={pattern:new RegExp([p,q,r,s,t,u].join("|")),found:function(c,d,e){e.length>0&&c.write("r.write(",a.quote(e),");"),d[1]||(d[2]?c.write("r.write(",a.quote(d[2]),");"):d[3]?c.write(d[3]):d[4]?c.nest(b.inEmbedTag,d[4]):d[5]?c.nest(b.inOpenTag,d[5]):d[6]&&c.nest(b.inCloseTag,d[6]))},notfound:function(b,c){b.write("r.write(",a.quote(c),");")}},b.inEmbedTag={enter:function(a){a.write("r.write("),a.nest(b.inValue)},leave:function(a){a.write(");")}},b.inOpenTag={pattern:new RegExp("^("+g+")(.*)$"),found:function(c,d){var e=d[1].toLowerCase();b.SpecialTags[e]?c.nest(b.SpecialTags[e],d[0]):(c.write("r.call(",a.quote(e),","),d[2]?c.nest(b.inOpenTagArgs,d[2],function(a){a.write(");")}):c.write("{});"))},notfound:function(a){a.raiseError("invalid open tag")}},b.inOpenTagArgs={enter:function(a){a.write("{")},leave:function(a){a.write("}")},pattern:new RegExp("^\\s+("+g+")=("+n+")"),found:function(a,c){a.getLoopCount()>0&&a.write(","),a.write(c[1],":"),a.nest(b.inValue,c[2])},notfound:function(a){a.raiseError("invalid open tag argument")}},b.inCloseTag={pattern:new RegExp("^("+g+")$"),found:function(c,d){var e=d[1].toLowerCase();b.SpecialTags["/"+e]?c.nest(b.SpecialTags["/"+e],d[0]):c.write("r.call(",a.quote(e+"Close"),");")},notfound:function(a){a.raiseError("invalid close tag")}},b.inValue={pattern:new RegExp(n),found:function(c,d){var e,f=this;if(d[6]&&(c.write("r.pipe("),e=function(a){a.write(")"),a.nest(b.inPipe,d[6],function(a){a.write(".valueOf()")})}),d[1])if(d[2]){"smarty"===d[1]||"jarty"===d[1]?c.write("r.getEnvVar("):c.write("r.get(",a.quote(d[1]),",");var g=e;c.nest(b.inVariableSuffix,d[2],function(a){a.write(")"),g&&g.call(f,a)}),e=void 0}else c.write("r.dict[",a.quote(d[1]),"]");else d[3]?d[3].length<=2?c.write('""'):(c.nest(b.inString,d[3].slice(1,-1),e),e=void 0):d[4]?c.write(d[4]):d[5]&&(b.SpecialBarewords[d[5]]?c.write(b.SpecialBarewords[d[5]]):c.write(a.quote(d[5])));e&&e.call(this,c)},notfound:function(a){a.raiseError("invalid value")}},b.inVariableSuffix={enter:function(a){a.write("[")},leave:function(a){a.write("]")},pattern:new RegExp("^(?:"+["(?:\\.|->)("+g+")","(?:\\.|->)\\$("+g+")("+i+"*)","("+i+")","("+h+")"].join("|")+")"),found:function(c,d){c.getLoopCount()>0&&c.write(","),d[1]?c.write(a.quote(d[1])):d[2]?d[3]?(c.write("r.get(",a.quote(d[2]),","),c.nest(b.inVariableSuffix,d[3],function(a){a.write(")")})):c.write("r.dict[",a.quote(d[2]),"]"):d[4]?c.nest(b.inIndexer,d[4]):c.nest(b.inFuncCall,d[5])},notfound:function(a){a.raiseError("invalid value indexer")}},b.inIndexer={pattern:/^\[\s*((?:[^\[\]]|\[[^\]]+\])+)\s*\]/,found:function(a,c){a.nest(b.inValue,c[1])},notfound:function(a){a.raiseError("invalid indexer")}},b.inFuncCall={pattern:/^\(\s*([^\)]*)\s*\)/,found:function(a,c){a.write("["),a.nest(b.inFuncCallArgs,c[1],function(a){a.write("]")})},notfound:function(a){a.raiseError("invalid function call")}},b.inFuncCallArgs={pattern:new RegExp("^(\\,?)\\s*("+n+")"),found:function(a,c){c[1]&&a.write(","),a.nest(b.inValue,c[2])},notfound:function(a){a.raiseError("invalid function arguments")}},b.inString={pattern:new RegExp("^((?:[^\\\\`]+|\\\\u[0-9a-fA-F]{4}|\\\\x[0-9a-fA-F]{2}|\\\\.)+)|^`("+n+")`"),found:function(c,d){c.getLoopCount()>0&&c.write("+"),d[1]?c.write(a.quote(d[1])):d[2]&&c.nest(b.inValue,d[2])}},b.inPipe={pattern:new RegExp("^\\|@?("+g+")((?::"+l+")*)"),found:function(c,d){c.write(".call(",a.quote(d[1]),", ["),d[2]?c.nest(b.inPipeArgs,d[2],function(a){a.write("])")}):c.write("])")},notfound:function(a){a.raiseError("invalid pipe")}},b.inPipeArgs={pattern:new RegExp("^:("+l+")"),found:function(a,c){a.getLoopCount()>0&&a.write(","),a.nest(b.inValue,c[1])},notfound:function(a){a.raiseError("invalid pipe argument")}},b.inIfTag={enter:function(a){a.write("if (")},leave:function(a){a.write(") {")},pattern:/^if\s+(.+)$/,found:function(a,c){a.nest(b.inIfCondition,c[1])},notfound:function(a){a.raiseError("invalid if tag")}},b.inElseTag={enter:function(a){a.write("} else {")}},b.inElseIfTag={enter:function(a){a.write("} else if (")},leave:function(a){a.write(") {")},pattern:/^elseif\s+(.+)$/,found:function(a,c){a.nest(b.inIfCondition,c[1])},notfound:function(a){a.raiseError("invalid elseif tag")}},b.inEndIfTag={enter:function(a){a.write("}")}},b.inIfCondition={pattern:new RegExp("^\\s*(?:("+o+")|(and)|(or)|(not)|("+n+"))"),found:function(a,c){c[1]?a.write(c[1]):c[2]?a.write("&&"):c[3]?a.write("||"):c[4]?a.write("!"):c[5]&&a.nest(b.inValue,c[5])},notfound:function(a){a.raiseError("invalid if condition")}},b.inForeachTag={pattern:/^foreach(\s+.+)$/,found:function(a,c){a.write("r.foreach("),a.nest(b.inOpenTagArgs,c[1],function(a){a.write(", function () {")})},notfound:function(a){a.raiseError("invalid foreach tag")}},b.inForeachElseTag={enter:function(a){a.write("}, function () {")}},b.inEndForeachTag={enter:function(a){a.write("});")}},b.inForTag={pattern:/^for(\s+.+)$/,found:function(a,c){a.write("r.for_("),a.nest(b.inOpenTagArgs,c[1],function(a){a.write(", function () {")})},notfound:function(a){a.raiseError("invalid for tag")}},b.inForElseTag={enter:function(a){a.write("}, function () {")}},b.inEndForTag={enter:function(a){a.write("});")}},b.SpecialTags={"if":b.inIfTag,"else":b.inElseTag,elseif:b.inElseIfTag,"/if":b.inEndIfTag,foreach:b.inForeachTag,foreachelse:b.inForeachElseTag,"/foreach":b.inEndForeachTag,"for":b.inForTag,forelse:b.inForElseTag,"/for":b.inEndForTag},b.SpecialBarewords={"true":"true","false":"false","null":"null",undefined:"undefined",NaN:"NaN"}}(a.Rules||(a.Rules={}));a.Rules}(Jarty||(Jarty={}));var Jarty;!function(a){var b=function(){function b(b){"undefined"==typeof b&&(b=a.Rules.start),this.rule=b}return b.prototype.compile=function(b){var c=this.compileToString(b);try{var d=new Function("r",c)}catch(e){throw new a.SyntaxError("Jarty compile error: "+(e.message||e)+"\n"+(c.length>60?c.substr(0,60)+"...":c))}var f=function(b){var c=new a.Runtime(b||{});return d(c),c.finish()};return f.jartySource=b,f.jartyCompiled=c,f},b.prototype.compileToString=function(b){b=a.stringify(b);var c=new a.Translator(this.rule);return c.translate(b)},b}();a.Compiler=b}(Jarty||(Jarty={}));var Jarty;!function(a){function b(b){return d=d||new a.Compiler,d.compile(b)}function c(a,c){return b(a)(c)}var d=null;a.compile=b,a.render=c}(Jarty||(Jarty={}));var Jarty;!function(Jarty){Jarty.Functions.register("ldelim",function(a){a.write("{")}),Jarty.Functions.register("rdelim",function(a){a.write("}")}),Jarty.Functions.register("assign",function(a,b){b["var"]||a.raiseError("assign: `var` is not given"),a.set(b["var"],b.value)}),Jarty.Functions.register("capture",function(a,b){a.startCapture(b.name||"default",b.assign)}),Jarty.Functions.register("captureClose",function(a){a.endCapture()}),Jarty.Functions.register("strip",function(a){a.startStrip()}),Jarty.Functions.register("stripClose",function(a){a.endStrip()}),Jarty.Functions.register("math",function(runtime,params){params.equation||runtime.raiseError("math: `equation` is not given"),params.format&&runtime.raiseError("math: `format` is not implemented");var equation=Jarty.stringify(params.equation),answer;try{answer=Jarty.stringify(eval("with (params) { with (Math) { "+equation+" } }"))}catch(e){runtime.raiseError("math: invalid equation: "+(e.message||e))}params.assign?runtime.set(params.assign,answer):runtime.write(answer)}),Jarty.Functions.register("counter",function(a,b){var c=b.name||"default",d=a.env.counters[c],e=!1;d||(a.env.counters[c]=d={count:1,skip:1,upward:!0},e=!0),void 0!==b.start&&(d.count=parseInt(b.start,10)||0),void 0!==b.skip&&(d.skip=parseInt(b.skip,10)||0),void 0!==b.direction&&(d.upward="up"===b.direction),void 0!==b.start||e||(d.count+=d.skip*(d.upward?1:-1)),(b.print||void 0===b.print)&&a.write(d.count.toString()),b.assign&&a.set(b.assign,d.count)})}(Jarty||(Jarty={}));var Jarty;!function(a){a.Pipes.register("default",function(a,b,c){return"undefined"==typeof c&&(c=null),""===b||null===b||void 0===b?c:b}),a.Pipes.register("cat",function(b,c,d){return"undefined"==typeof d&&(d=""),a.stringify(c)+d}),a.Pipes.register("lower",function(b,c){return a.stringify(c).toLowerCase()}),a.Pipes.register("upper",function(b,c){return a.stringify(c).toUpperCase()}),a.Pipes.register("count_characters",function(b,c,d){return"undefined"==typeof d&&(d=!1),d?a.stringify(c).length:a.stringify(c).replace(/\s+/g,"").length}),a.Pipes.register("count_paragraphs",function(b,c){return a.stringify(c).split(/[\r\n]+/).length}),a.Pipes.register("count_sentences",function(b,c){return(a.stringify(c).match(/[^\s]\.(?!\w)/g)||[]).length}),a.Pipes.register("count_words",function(b,c){return(a.stringify(c).match(/(?:^|\s)\S*[a-zA-Z0-9\x80-\xff]/g)||[]).length}),a.Pipes.register("nl2br",function(b,c){return a.stringify(c).replace(/\n/g,"<br />")}),a.Pipes.register("regex_replace",function(b,c,d,e){var f=a.stringify(d).match(/^(.)(.+)(\1)([a-z]*)$/);f||b.raiseError("regex_replace: `"+d+"` is not regexp");try{var g=new RegExp(f[2],f[4]+"g")}catch(h){b.raiseError("regex_replace: `"+d+"` is invalid regexp: "+(h.message||h))}return a.stringify(c).replace(g,a.stringify(e))}),a.Pipes.register("replace",function(b,c,d,e){d=a.stringify(d).replace(/([\\^$\(\)\-\|\[\]\+\*\?\{\}\<\>\/\.])/g,"\\$1");var f=new RegExp(d,"g");return a.stringify(c).replace(f,e)}),a.Pipes.register("spacify",function(b,c,d){return"undefined"==typeof d&&(d=" "),a.stringify(c).split("").join(d)}),a.Pipes.register("strip",function(b,c,d){return"undefined"==typeof d&&(d=" "),a.stringify(c).replace(/\s+/g,d)}),a.Pipes.register("strip_tags",function(b,c,d){return"undefined"==typeof d&&(d=!0),a.stringify(c).replace(/<[^>]*?>/g,d?" ":"")}),a.Pipes.register("truncate",function(b,c,d,e,f,g){return"undefined"==typeof d&&(d=80),"undefined"==typeof e&&(e="..."),"undefined"==typeof f&&(f=!1),"undefined"==typeof g&&(g=!1),d=parseInt(d,10)||0,0===d?"":(c=a.stringify(c),d=Math.max(d,e.length+1),c.length>d?(d-=e.length,f||g?g?c.slice(0,Math.ceil(d/2))+e+c.slice(-Math.floor(d/2)):c.slice(0,d)+e:c.slice(0,d).replace(/\s+?(\S+)?$/,"")+e):c)})}(Jarty||(Jarty={}));var Jarty;!function(a){a.Pipes.register("escape",function(c,d,e){return"undefined"==typeof e&&(e="html"),"function"!=typeof b[e]&&c.raiseError("escape: format `"+e+"` does not exist"),b[e](a.stringify(d))});var b;!function(b){function c(a){return a.replace(/[&"'<>]/g,function(a){return m[a]})}function d(){throw"not implemented: htmlall"}function e(a){return encodeURIComponent(a)}function f(a){return encodeURIComponent(a).replace(/%2F/g,"/")}function g(a){return a.replace(/((?:[^\\']|\\.)+)|(')/g,function(a,b,c){return c?"\\'":b})}function h(a){var b=encodeURIComponent(a);return b.replace(/(%[0-9A-F]{2})|(.)/g,function(a,b,c){return b?b:"%"+c.charCodeAt(0).toString(16)})}function i(b){for(var c="",d=0,e=b.length;e>d;d++){var f=b.charCodeAt(d);c+="&#x"+a.zeroPad(f,f>255?4:2,16)+";"}return c}function j(a){for(var b="",c=0,d=a.length;d>c;c++)b+="&#"+a.charCodeAt(c)+";";return b}function k(a){return a.replace(/[\\'"\r\n]|<\//g,function(a){return n[a]})}function l(a){return a.replace(/@/g," [AT] ").replace(/\./g," [DOT] ")}var m={"&":"&amp;",'"':"&quot;","'":"&#039;","<":"&lt;",">":"&gt;"},n={"\\":"\\\\","'":"\\'",'"':'\\"',"\r":"\\r","\n":"\\n","</":"<\\/"};b.html=c,b.htmlall=d,b.url=e,b.urlpathinfo=f,b.quotes=g,b.hex=h,b.hexentity=i,b.decentity=j,b.javascript=k,b.mail=l}(b||(b={}))}(Jarty||(Jarty={})),"undefined"!=typeof module&&module.exports?module.exports=Jarty:this.Jarty=Jarty}();